<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" assembly="Transport" namespace="Transport.OtherModels.farm" default-lazy="false">


    <class name="BaseWaybill" table="Waybill">

        <id name="WaybillId">
            <generator class="native"/>
        </id>

        <discriminator column="DSK"  not-null="false" insert="false" />
        
        <property name="VehicleId" index="idx_VehiclePosition" />
        <property name="Position"  index="idx_VehiclePosition"  />

        <property name="DepartureDate" />
        <property name="ReturnDate" />
        <property name="FormNumber" />
        <property name="WaybillTypeId" />
        <property name="Way" />
        <property name="DriverId"/>
        <property name="Shift" />
        <property name="isClosed" />


        <subclass name="Waybill" discriminator-value="null">
            
            <bag name="WaybillTasks" cascade="all-delete-orphan" inverse="true" fetch="select">
                <key column="WaybillId"/>
                <one-to-many class="WaybillTask"/>
            </bag>

            <bag name="WaybillDrivers" cascade="all-delete-orphan" >
                <key>
                    <column unique-key="key_WaybillDriver" name="WaybillId"/>
                </key>
              <element>
                <column unique-key="key_WaybillDriver" name="DriverId"/>
              </element>
            </bag>

            <bag name="WaybillCounters" cascade="all-delete-orphan" inverse="true">
                <key column="WaybillId"/>
                <one-to-many class="WaybillCounter"/>
            </bag>
            
            <bag name="WaybillRefuelling" cascade="all-delete-orphan" inverse="true">
                <key column="WaybillId"/>
                <one-to-many class="WaybillRefuelling"/>
            </bag>
          
            <bag name="WaybillFuelRemains" cascade="all-delete-orphan" inverse="true">
              <key column="WaybillId"/>
              <one-to-many class="WaybillFuelRemain"/>
            </bag>

        </subclass>

        <subclass name="WaybillList" discriminator-value="null">
            
        </subclass>
        
    </class>


    <class name="WaybillDrivers">
        <composite-id>
            <key-property name="WaybillId"/>
            <key-many-to-one class="Driver" name="Driver" column="DriverId"/>
        </composite-id>
    </class>


</hibernate-mapping>